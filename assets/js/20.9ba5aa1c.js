(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{402:function(t,s,e){"use strict";e.r(s);var a=e(10),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("A SQL Trick I Wish I Had Known Long Ago. In software development, separating business logic or domain logic from an application and other layers is a crucial architectural principle. One of the most important layers in business logic is the persistence layer.")]),t._v(" "),e("p",[t._v("Keeping the persistence layer decoupled via interfaces allows us to keep database-specific implementations out of domain logic. However, this is not entirely true. No matter how much we try to decouple the persistence layer from a specific DBMS, it always ends up being influenced by it.")]),t._v(" "),e("p",[e("strong",[t._v("How Does the Persistence Layer Get Tightly Coupled?")])]),t._v(" "),e("p",[t._v("You might think that defining a repository interface ensures complete decoupling. However, this is not the case because every database management system (DBMS) has a common way to store data, whether they call it a tuple, table, record, or object. These concepts inevitably leak into abstractions one way or another.")]),t._v(" "),e("p",[t._v("As a result, different domain use cases might not match the repository interface operations, forcing us to name them based on database-specific details rather than business logic.")]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"a-practical-example-order-processing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-practical-example-order-processing"}},[t._v("#")]),t._v(" A Practical Example: Order Processing")]),t._v(" "),e("p",[t._v("Consider a scenario where an order goes through multiple stages:")]),t._v(" "),e("ul",[e("li",[t._v("A "),e("strong",[t._v("Draft Order")]),t._v(" is created with initial details.")]),t._v(" "),e("li",[t._v("A "),e("strong",[t._v("Confirmed Order")]),t._v(" is finalized after payment and shipping details are provided.")])]),t._v(" "),e("p",[t._v("In a order processing domain, consider following "),e("code",[t._v("OrderService")]),t._v(" that uses "),e("code",[t._v("OrderRepository")]),t._v(" interface to perform order processing related persistence operations:")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" order\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("OrderServer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateDraftOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" order DraftOrder"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpdateOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" err\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("OrderServer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ConfirmOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" order ConfirmedOrder"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpdateOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" err\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[e("strong",[t._v("Problem: Generic "),e("code",[t._v("UpdateOrder")]),t._v(" Method")])]),t._v(" "),e("p",[t._v("A naive approach would be to define an "),e("code",[t._v("UpdateOrder")]),t._v(" method that handles both cases. To support this, we might define a repository interface like this:")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" order\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" OrderRepository "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpdateOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" order Order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderID "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[e("strong",[t._v("Why is this problematic?")]),e("code",[t._v("UpdateOrder")]),t._v(" does not match our actual business use cases. Instead of having separate operations for "),e("code",[t._v("DraftOrder")]),t._v(" and "),e("code",[t._v("ConfirmOrder")]),t._v(", it forces us to use a single method influenced by database knowledge.\nYou might be thinking, well, i can still have two operations defined in the repository interface and solve the problem, But, the repository must first find the existing order, modify fields as per the use case, and then execute the update query. This leads to tight coupling, higher risk of bugs, extra logic for retrieving existing order, updating specific fields, hard-to-maintain code, and potential data corruption.")]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"solution-using-sql-views-for-controlled-inserts-and-updates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#solution-using-sql-views-for-controlled-inserts-and-updates"}},[t._v("#")]),t._v(" Solution: Using SQL Views for Controlled Inserts and Updates")]),t._v(" "),e("p",[t._v("Instead of exposing the "),e("code",[t._v("orders")]),t._v(" table for direct inserts/updates, we can define SQL views that restrict what data can be inserted or modified at each stage.")]),t._v(" "),e("h3",{attrs:{id:"step-1-define-the-base-table"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-1-define-the-base-table"}},[t._v("#")]),t._v(" Step 1: Define the Base Table")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" orders "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    order_id "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SERIAL")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    customer_id "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    items JSONB "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TEXT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'draft'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    payment_info "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TEXT")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    shipping_address "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TEXT")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("This table will hold both draft orders and confirmed orders, but the repository should not be able to insert/update all fields directly.")]),t._v(" "),e("hr"),t._v(" "),e("h3",{attrs:{id:"step-2-create-views-for-controlled-inserts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-2-create-views-for-controlled-inserts"}},[t._v("#")]),t._v(" Step 2: Create Views for Controlled Inserts")]),t._v(" "),e("p",[t._v("Instead of exposing the full "),e("code",[t._v("orders")]),t._v(" table, we define two SQL views:")]),t._v(" "),e("h4",{attrs:{id:"view-for-draft-orders"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#view-for-draft-orders"}},[t._v("#")]),t._v(" View for Draft Orders")]),t._v(" "),e("p",[t._v("Allows inserting only draft order info such as "),e("code",[t._v("customer_id")]),t._v(" and "),e("code",[t._v("items")]),t._v(" (no accidental updates to "),e("code",[t._v("status")]),t._v(", "),e("code",[t._v("payment_info")]),t._v(", or "),e("code",[t._v("shipping_address")]),t._v(").")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VIEW")]),t._v(" draft_orders "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" order_id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" customer_id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" items\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" orders"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("A "),e("code",[t._v("CreateDraftOrder")]),t._v(" repository operation will use this view to insert new orders.")]),t._v(" "),e("h4",{attrs:{id:"view-for-confirmed-orders"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#view-for-confirmed-orders"}},[t._v("#")]),t._v(" View for Confirmed Orders")]),t._v(" "),e("p",[t._v("Allows updating only confirm order info such as "),e("code",[t._v("status")]),t._v(", "),e("code",[t._v("payment_info")]),t._v(", and "),e("code",[t._v("shipping_address")]),t._v(" (ensuring no modifications to "),e("code",[t._v("items")]),t._v(" or "),e("code",[t._v("customer_id")]),t._v(").")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VIEW")]),t._v(" confirmed_orders "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" order_id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payment_info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shipping_address\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" orders"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("A "),e("code",[t._v("ConfirmOrder")]),t._v(" repository operation will use this view for finalizing orders.")]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"implementing-in-go"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#implementing-in-go"}},[t._v("#")]),t._v(" Implementing in Go")]),t._v(" "),e("p",[t._v("With database views in place, we can define a clean repository interface that aligns with business logic:")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" OrderRepository "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateDraftOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DraftOrder"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ConfirmOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ConfirmOrder"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"go-implementation-using-postgresql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#go-implementation-using-postgresql"}},[t._v("#")]),t._v(" Go Implementation Using PostgreSQL")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" postgres\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("OrderRepository"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateDraftOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DraftOrder"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" orderID "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("\n    query "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("`INSERT INTO draft_orders (customer_id, items) VALUES ($1, $2) RETURNING order_id;`")]),t._v("\n    err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" r"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("QueryRow")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CustomerID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Items"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Scan")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("orderID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" orderID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("OrderRepository"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ConfirmOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ConfirmOrder"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    query "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("`UPDATE confirmed_orders SET status = $1, payment_info = $2, shipping_address = $3 WHERE order_id = $4;`")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" r"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PaymentInfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShippingAddress"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" err\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("hr"),t._v(" "),e("p",[t._v("Let's now take a look at the trade-offs and important considerations when using SQL views for structuring inserts and updates by answer some important question:")]),t._v(" "),e("h3",{attrs:{id:"are-views-acid-compliant"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#are-views-acid-compliant"}},[t._v("#")]),t._v(" Are Views ACID-Compliant?")]),t._v(" "),e("p",[t._v("Yes! Views preserve ACID properties because they ultimately operate on the base table.")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("Atomicity")]),t._v(" → Transactions ensure that either all changes succeed or none do.")]),t._v(" "),e("li",[e("strong",[t._v("Consistency")]),t._v(" → Constraints on the base table still apply.")]),t._v(" "),e("li",[e("strong",[t._v("Isolation")]),t._v(" → Views respect the transaction isolation level (e.g., "),e("code",[t._v("SERIALIZABLE")]),t._v(").")]),t._v(" "),e("li",[e("strong",[t._v("Durability")]),t._v(" → Once committed, changes persist just like normal table operations.")])]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("Caveat:")]),t._v(" Views don’t have their own indexes, so query performance depends on the base table’s indexes.")])]),t._v(" "),e("hr"),t._v(" "),e("h3",{attrs:{id:"why-is-this-approach-better"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#why-is-this-approach-better"}},[t._v("#")]),t._v(" Why Is This Approach Better?")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("Clear Separation of Concerns")]),t._v(" → The repository aligns with business workflow.")]),t._v(" "),e("li",[e("strong",[t._v("Prevents Accidental Updates")]),t._v(" → No risk of modifying restricted fields.")]),t._v(" "),e("li",[e("strong",[t._v("More Maintainable")]),t._v(" → Each method is focused and does exactly what it needs.")]),t._v(" "),e("li",[e("strong",[t._v("Enforces Data Integrity at the Database Level")]),t._v(" → Without extra application logic.")])]),t._v(" "),e("h3",{attrs:{id:"when-should-you-use-this-approach"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#when-should-you-use-this-approach"}},[t._v("#")]),t._v(" When Should You Use This Approach?")]),t._v(" "),e("ul",[e("li",[t._v("If your business logic requires separating different update responsibilities.")]),t._v(" "),e("li",[t._v("If you want database-enforced constraints without adding complex validation logic in Go.")]),t._v(" "),e("li",[t._v("If you need clean repository interfaces that align with business operations.")])]),t._v(" "),e("h3",{attrs:{id:"when-not-to-use-it"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#when-not-to-use-it"}},[t._v("#")]),t._v(" When Not to Use It?")]),t._v(" "),e("ul",[e("li",[t._v("If your views involve complex joins or aggregations (they might not be updatable).")]),t._v(" "),e("li",[t._v("If you require dynamic business rules which are more complicated to implement and might involve external sources.")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"final-thoughts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#final-thoughts"}},[t._v("#")]),t._v(" Final Thoughts")]),t._v(" "),e("p",[t._v("Using SQL views to enforce structured inserts and updates is a powerful yet often overlooked technique. It provides data integrity, security, and maintainability while keeping repository interfaces clean and business-driven.")]),t._v(" "),e("p",[t._v("If you're designing a business-critical Go application, this approach ensures that each stage of the workflow has dedicated persistence logic, preventing accidental updates while maintaining clean architecture. 🚀")])])}),[],!1,null,null,null);s.default=n.exports}}]);